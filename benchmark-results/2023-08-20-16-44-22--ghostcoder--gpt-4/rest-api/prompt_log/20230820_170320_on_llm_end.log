method: on_llm_end [2023-08-20 17:03:20]
llm_output: {"token_usage": {"prompt_tokens": 748, "completion_tokens": 636, "total_tokens": 1384}, "model_name": "gpt-4"}
prompt:
To implement the RESTful API for tracking IOUs, we need to update the `RestAPI` class in the `rest_api.py` file. 

We will add a `database` attribute to the `__init__` method to store the user data. 

In the `get` method, we will check if the URL is '/users'. If it is, we will return the user information. If a payload is provided, we will return the information of the specified users. If no payload is provided, we will return the information of all users.

In the `post` method, we will check the URL. If the URL is '/add', we will add a new user to the database. If the URL is '/iou', we will update the 'owes' and 'owed_by' fields of the lender and borrower, and update their balances.

Filepath: rest_api.py
```python
import json

class RestAPI:
    def __init__(self, database=None):
        self.database = database if database else {"users": []}

    def get(self, url, payload=None):
        if url == "/users":
            if payload:
                names = json.loads(payload)["users"]
                return json.dumps({"users": [user for user in self.database["users"] if user["name"] in names]})
            else:
                return json.dumps(self.database)

    def post(self, url, payload=None):
        if url == "/add":
            name = json.loads(payload)["user"]
            user = {"name": name, "owes": {}, "owed_by": {}, "balance": 0.0}
            self.database["users"].append(user)
            return json.dumps(user)
        elif url == "/iou":
            data = json.loads(payload)
            lender = next(user for user in self.database["users"] if user["name"] == data["lender"])
            borrower = next(user for user in self.database["users"] if user["name"] == data["borrower"])
            amount = data["amount"]

            if borrower["name"] in lender["owed_by"]:
                lender["owed_by"][borrower["name"]] -= amount
                if lender["owed_by"][borrower["name"]] <= 0:
                    amount = -lender["owed_by"][borrower["name"]]
                    del lender["owed_by"][borrower["name"]]
                else:
                    amount = 0
            if amount > 0:
                lender["owes"][borrower["name"]] = lender["owes"].get(borrower["name"], 0) + amount
                borrower["owed_by"][lender["name"]] = borrower["owed_by"].get(lender["name"], 0) + amount

            lender["balance"] = sum(lender["owed_by"].values()) - sum(lender["owes"].values())
            borrower["balance"] = sum(borrower["owed_by"].values()) - sum(borrower["owes"].values())

            return json.dumps({"users": sorted([lender, borrower], key=lambda x: x["name"])})
```
---
